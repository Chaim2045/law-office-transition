<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×©××™×¨×” - Content Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ×‘×“×™×§×ª ×©××™×¨×” - ××¢×¨×›×ª ×¢×¨×™×›×ª ×ª×•×›×Ÿ</h1>

    <div class="test-section">
        <h2>×”×•×¨××•×ª ×‘×“×™×§×”:</h2>
        <ol>
            <li>×¤×ª×— ××ª ×”×§×•× ×¡×•×œ (F12) ×›×“×™ ×œ×¨××•×ª ×”×•×“×¢×•×ª ×©××™×¨×”</li>
            <li>×œ×—×¥ ×¢×œ "×”×ª×—×œ ×‘×“×™×§×”" ×œ×”×¤×¢×œ×ª ×”×‘×“×™×§×•×ª</li>
            <li>×‘×“×•×§ ××ª ×”×ª×•×¦××•×ª ×œ××˜×”</li>
            <li>× ×¡×” ×œ×¢×¨×•×š ×˜×§×¡×˜ ×‘×¢××•×“ ×”×¨××©×™ ×•×‘×“×•×§ ×©×”×•× × ×©××¨</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>×‘×“×™×§×•×ª ××•×˜×•××˜×™×•×ª:</h2>
        <button onclick="runTests()">×”×ª×—×œ ×‘×“×™×§×”</button>
        <button onclick="clearLogs()">× ×§×” ×œ×•×’</button>
        <div id="test-results"></div>
        <div class="log-output" id="log-output"></div>
    </div>

    <div class="test-section">
        <h2>×‘×“×™×§×” ×™×“× ×™×ª:</h2>
        <button onclick="testManualSave()">×‘×“×•×§ ×©××™×¨×” ×™×“× ×™×ª</button>
        <button onclick="checkLocalStorage()">×”×¦×’ LocalStorage</button>
        <button onclick="checkFirebase()">×‘×“×•×§ ×—×™×‘×•×¨ Firebase</button>
    </div>

    <script>
        const logOutput = document.getElementById('log-output');
        const testResults = document.getElementById('test-results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#0f0' : type === 'error' ? '#f00' : '#0ff';
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            logOutput.innerHTML = '';
            testResults.innerHTML = '';
        }

        function addResult(message, success) {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.textContent = (success ? 'âœ… ' : 'âŒ ') + message;
            testResults.appendChild(div);
        }

        function runTests() {
            clearLogs();
            log('ğŸš€ ××ª×—×™×œ ×‘×“×™×§×•×ª...', 'info');

            // ×‘×“×™×§×” 1: ×”×× Firebase ×˜×¢×•×Ÿ
            const firebaseLoaded = typeof firebase !== 'undefined';
            addResult('Firebase SDK ×˜×¢×•×Ÿ', firebaseLoaded);
            log(`Firebase: ${firebaseLoaded ? 'âœ…' : 'âŒ'}`, firebaseLoaded ? 'success' : 'error');

            // ×‘×“×™×§×” 2: ×¤×•× ×§×¦×™×•×ª Firebase
            const saveFunctionExists = typeof saveToFirebase === 'function';
            addResult('×¤×•× ×§×¦×™×™×ª saveToFirebase ×§×™×™××ª', saveFunctionExists);
            log(`saveToFirebase: ${saveFunctionExists ? 'âœ…' : 'âŒ'}`, saveFunctionExists ? 'success' : 'error');

            const loadFunctionExists = typeof loadAllDataFromFirebase === 'function';
            addResult('×¤×•× ×§×¦×™×™×ª loadAllDataFromFirebase ×§×™×™××ª', loadFunctionExists);
            log(`loadAllDataFromFirebase: ${loadFunctionExists ? 'âœ…' : 'âŒ'}`, loadFunctionExists ? 'success' : 'error');

            // ×‘×“×™×§×” 3: ContentBlockManager
            const managerExists = typeof window.ContentBlockManager !== 'undefined';
            addResult('ContentBlockManager ×§×™×™×', managerExists);
            log(`ContentBlockManager: ${managerExists ? 'âœ…' : 'âŒ'}`, managerExists ? 'success' : 'error');

            if (managerExists) {
                const saveBlockExists = typeof window.ContentBlockManager.saveBlock === 'function';
                addResult('×¤×•× ×§×¦×™×™×ª saveBlock ×§×™×™××ª', saveBlockExists);
                log(`saveBlock: ${saveBlockExists ? 'âœ…' : 'âŒ'}`, saveBlockExists ? 'success' : 'error');

                const blocksCount = window.ContentBlockManager.blocks.size;
                addResult(`× ××¦××• ${blocksCount} ×‘×œ×•×§×™× ×‘××¢×¨×›×ª`, blocksCount > 0);
                log(`×‘×œ×•×§×™×: ${blocksCount}`, blocksCount > 0 ? 'success' : 'error');
            }

            // ×‘×“×™×§×” 4: RichTextEditor
            const editorExists = typeof window.RichTextEditor !== 'undefined';
            addResult('RichTextEditor ×§×™×™×', editorExists);
            log(`RichTextEditor: ${editorExists ? 'âœ…' : 'âŒ'}`, editorExists ? 'success' : 'error');

            if (editorExists) {
                const saveCurrentBlockExists = typeof window.RichTextEditor.saveCurrentBlock === 'function';
                addResult('×¤×•× ×§×¦×™×™×ª saveCurrentBlock ×§×™×™××ª ×‘-Editor', saveCurrentBlockExists);
                log(`saveCurrentBlock: ${saveCurrentBlockExists ? 'âœ…' : 'âŒ'}`, saveCurrentBlockExists ? 'success' : 'error');
            }

            // ×‘×“×™×§×” 5: Event listeners
            log('×‘×•×“×§ event listeners...', 'info');
            const hasInputListeners = true; // ×œ× × ×™×ª×Ÿ ×œ×‘×“×•×§ ×™×©×™×¨×•×ª
            addResult('Event listeners ××•×’×“×¨×™×', hasInputListeners);

            log('âœ… ×‘×“×™×§×•×ª ×”×¡×ª×™×™××•!', 'success');
        }

        function testManualSave() {
            log('ğŸ”§ ×‘×•×“×§ ×©××™×¨×” ×™×“× ×™×ª...', 'info');

            const testBlockId = 'test_block_manual_' + Date.now();
            const testContent = '×–×”×• ×˜×§×¡×˜ ×‘×“×™×§×” - ' + new Date().toLocaleTimeString();

            // ×©××•×¨ ×‘-localStorage
            localStorage.setItem(`guide_${testBlockId}`, testContent);
            log(`ğŸ’¾ × ×©××¨ ×œ-localStorage: ${testBlockId}`, 'success');

            // ×‘×“×•×§ ×× × ×©××¨
            const saved = localStorage.getItem(`guide_${testBlockId}`);
            if (saved === testContent) {
                log('âœ… ×”×©××™×¨×” ×‘-localStorage ×¢×‘×“×”!', 'success');
                addResult('×©××™×¨×” ××§×•××™×ª ×¢×•×‘×“×ª', true);
            } else {
                log('âŒ ×”×©××™×¨×” ×‘-localStorage × ×›×©×œ×”!', 'error');
                addResult('×©××™×¨×” ××§×•××™×ª × ×›×©×œ×”', false);
            }

            // × ×¡×” Firebase
            if (typeof saveToFirebase === 'function') {
                saveToFirebase(testBlockId, testContent)
                    .then(() => {
                        log('âœ… ×”×©××™×¨×” ×‘-Firebase ×¢×‘×“×”!', 'success');
                        addResult('×©××™×¨×” ×‘-Firebase ×¢×•×‘×“×ª', true);
                    })
                    .catch(err => {
                        log(`âŒ ×©×’×™××” ×‘-Firebase: ${err}`, 'error');
                        addResult('×©××™×¨×” ×‘-Firebase × ×›×©×œ×”', false);
                    });
            } else {
                log('âš ï¸ Firebase ×œ× ×–××™×Ÿ', 'error');
            }
        }

        function checkLocalStorage() {
            log('ğŸ“¦ ×‘×•×“×§ localStorage...', 'info');
            const keys = Object.keys(localStorage).filter(k => k.startsWith('guide_'));
            log(`× ××¦××• ${keys.length} ××¤×ª×—×•×ª ×©×©××•×¨×™×`, 'info');

            keys.slice(0, 10).forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value.length > 50 ? value.substring(0, 50) + '...' : value;
                log(`  ${key}: ${preview}`, 'info');
            });

            if (keys.length > 10) {
                log(`  ... ×•×¢×•×“ ${keys.length - 10} ××¤×ª×—×•×ª`, 'info');
            }
        }

        async function checkFirebase() {
            log('ğŸ”¥ ×‘×•×“×§ ×—×™×‘×•×¨ Firebase...', 'info');

            if (typeof loadAllDataFromFirebase !== 'function') {
                log('âŒ Firebase ×œ× ×–××™×Ÿ', 'error');
                addResult('Firebase ×œ× ×–××™×Ÿ', false);
                return;
            }

            try {
                const data = await loadAllDataFromFirebase();
                if (data) {
                    const count = Object.keys(data).length;
                    log(`âœ… Firebase ××—×•×‘×¨! × ××¦××• ${count} ×©×“×•×ª`, 'success');
                    addResult(`Firebase ××—×•×‘×¨ - ${count} ×©×“×•×ª`, true);

                    // ×”×¦×’ ×›××” ×“×•×’×××•×ª
                    const keys = Object.keys(data).filter(k => k.startsWith('block_'));
                    log(`×‘×œ×•×§×™× ×‘-Firebase: ${keys.length}`, 'info');
                } else {
                    log('âš ï¸ Firebase ××—×•×‘×¨ ××‘×œ ××™×Ÿ × ×ª×•× ×™×', 'error');
                    addResult('Firebase ×¨×™×§', false);
                }
            } catch (err) {
                log(`âŒ ×©×’×™××” ×‘×—×™×‘×•×¨ ×œ-Firebase: ${err}`, 'error');
                addResult('×©×’×™××” ×‘×—×™×‘×•×¨ ×œFirebase', false);
            }
        }

        // ×”×¨×¥ ×‘×“×™×§×•×ª ××•×˜×•××˜×™×ª ×¢× ×˜×¢×™× ×ª ×”×“×£
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸ¯ ×“×£ ×‘×“×™×§×” × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”', 'success');
                log('ğŸ’¡ ×œ×—×¥ ×¢×œ "×”×ª×—×œ ×‘×“×™×§×”" ×œ×”×ª×—×™×œ', 'info');
            }, 500);
        });
    </script>
</body>
</html>
