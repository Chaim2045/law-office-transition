<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×‘×“×™×§×ª ×›×ª×™×‘×” ×œ-Firebase</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      direction: rtl;
    }
    .result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .success {
      background: #d1fae5;
      border: 1px solid #059669;
    }
    .warning {
      background: #fef3c7;
      border: 1px solid #f59e0b;
    }
    .error {
      background: #fee2e2;
      border: 1px solid #dc2626;
    }
    button {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ ×‘×“×™×§×ª ×›×ª×™×‘×” ×œ-Firebase</h1>
  <p>×›×œ×™ ×–×” ×‘×•×“×§ ×× ××¤×©×¨ ×œ×›×ª×•×‘ ×œ-Firebase ×•××“×•×¢ ×–×” ×œ× ×¢×•×‘×“</p>

  <button onclick="testWritePermission()">ğŸ“ ×‘×“×•×§ ×”×¨×©××•×ª ×›×ª×™×‘×”</button>
  <button onclick="testRead()">ğŸ“– ×‘×“×•×§ ×§×¨×™××” ×-Firebase</button>
  <button onclick="checkAppConfig()">âš™ï¸ ×‘×“×•×§ APP_CONFIG</button>
  <button onclick="clearResults()">ğŸ—‘ï¸ × ×§×”</button>

  <div id="results"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // Initialize Firebase directly
    const firebaseConfig = {
      apiKey: 'AIzaSyC9R_eupXtdkzEMBwA1Dsc6SC_14_iUNLs',
      authDomain: 'law-office-guide.firebaseapp.com',
      databaseURL: 'https://law-office-guide-default-rtdb.europe-west1.firebasedatabase.app',
      projectId: 'law-office-guide',
      storageBucket: 'law-office-guide.firebasestorage.app',
      messagingSenderId: '903121364456',
      appId: '1:903121364456:web:91d02f021ab618d3a6705d',
      measurementId: 'G-3NZXL9YB35',
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    const resultsDiv = document.getElementById('results');

    function addResult(message, type = 'success') {
      const div = document.createElement('div');
      div.className = `result ${type}`;
      div.textContent = message;
      resultsDiv.appendChild(div);
    }

    function clearResults() {
      resultsDiv.innerHTML = '';
    }

    async function testRead() {
      clearResults();
      addResult('ğŸ“– ×‘×•×“×§ ×§×¨×™××” ×-Firebase...', 'success');

      try {
        const snapshot = await database.ref('guideData').get();

        if (snapshot.exists()) {
          const data = snapshot.val();
          const keys = Object.keys(data);
          addResult(`âœ… × ××¦××• ${keys.length} ××¤×ª×—×•×ª ×‘-guideData`, 'success');
          addResult(`Keys: ${keys.slice(0, 10).join(', ')}`, 'success');
          if (keys.length > 10) {
            addResult(`... ×•×¢×•×“ ${keys.length - 10}`, 'success');
          }
        } else {
          addResult('âš ï¸ guideData ×¨×™×§ ××• ×œ× ×§×™×™×', 'warning');
          addResult('×–×” ××•××¨ ×©×©×•× ×“×‘×¨ ×œ× × ×©××¨ ×¢×“×™×™×Ÿ', 'warning');
        }

        // Check entire database root
        const rootSnapshot = await database.ref('/').get();
        if (rootSnapshot.exists()) {
          const rootData = rootSnapshot.val();
          const rootKeys = Object.keys(rootData);
          addResult(`\nğŸ“¦ × ××¦××• ×‘root: ${rootKeys.join(', ')}`, 'success');
        } else {
          addResult('\nâŒ ×”××¡×“ × ×ª×•× ×™× ×¨×™×§ ×œ×’××¨×™!', 'error');
        }

      } catch (error) {
        addResult(`âŒ ×©×’×™××” ×‘×§×¨×™××”: ${error.message}`, 'error');
        console.error(error);
      }
    }

    async function testWritePermission() {
      clearResults();
      addResult('ğŸ“ ×‘×•×“×§ ×”×¨×©××•×ª ×›×ª×™×‘×”...', 'success');

      try {
        // Try to write a test value
        const testRef = database.ref('guideData/test_write_' + Date.now());
        addResult('×× ×¡×” ×œ×›×ª×•×‘ ×¢×¨×š ×˜×¡×˜...', 'success');

        await testRef.set({
          content: '×‘×“×™×§×”',
          timestamp: Date.now(),
          test: true
        });

        addResult('âœ… ×›×ª×™×‘×” ×”×¦×œ×™×—×”!', 'success');

        // Try to read it back
        const snapshot = await testRef.get();
        if (snapshot.exists()) {
          addResult('âœ… ×§×¨×™××” ×—×–×¨×” ×”×¦×œ×™×—×”!', 'success');
          addResult(`Data: ${JSON.stringify(snapshot.val())}`, 'success');
        }

        // Clean up
        await testRef.remove();
        addResult('âœ… × ×™×§×•×™ ×”×•×©×œ×', 'success');

        addResult('\nğŸ‰ Firebase ×¢×•×‘×“ ×ª×§×™×Ÿ!', 'success');
        addResult('×”×‘×¢×™×” ×”×™× ×©×”××¤×œ×™×§×¦×™×” ×œ× ×›×•×ª×‘×ª ×‘×¤×•×¢×œ', 'warning');

      } catch (error) {
        addResult(`âŒ ×›×ª×™×‘×” × ×›×©×œ×”: ${error.message}`, 'error');
        addResult(`Error code: ${error.code}`, 'error');

        if (error.code === 'PERMISSION_DENIED') {
          addResult('\nğŸ”’ ×–×•×”×™ ×‘×¢×™×™×ª ×”×¨×©××•×ª!', 'error');
          addResult('×¦×¨×™×š ×œ×¢×“×›×Ÿ ××ª Firebase Rules:', 'error');
          addResult(`
{
  "rules": {
    ".read": true,
    ".write": true
  }
}`, 'error');
          addResult('\n×œ×š ×œ-Firebase Console â†’ Realtime Database â†’ Rules', 'error');
        }

        console.error(error);
      }
    }

    function checkAppConfig() {
      clearResults();
      addResult('âš™ï¸ ×‘×•×“×§ APP_CONFIG...', 'success');

      // Check if we're on the main site
      addResult(`URL: ${window.location.href}`, 'success');
      addResult(`Hostname: ${window.location.hostname}`, 'success');

      const isLocalhost = ['localhost', '127.0.0.1', '[::1]'].includes(window.location.hostname);
      addResult(`Is localhost: ${isLocalhost}`, isLocalhost ? 'warning' : 'success');

      if (isLocalhost) {
        addResult('\nâš ï¸ ××ª×” ×‘-localhost!', 'warning');
        addResult('APP_CONFIG.enableFirebaseWrites ×›× ×¨××” false', 'warning');
        addResult('×–×” ××•× ×¢ ×›×ª×™×‘×” ×œ-Firebase', 'warning');
        addResult('\nğŸ’¡ ×¤×ª×¨×•×Ÿ:', 'success');
        addResult('1. ×‘×§×•× ×¡×•×œ ×©×œ ×”××ª×¨ ×”×¨××©×™, ×”×¨×¥:', 'success');
        addResult('   window.APP_CONFIG.enableFirebaseWrites = true;', 'success');
        addResult('2. ××• ×”×•×¡×£ ?safe=0 ×œ-URL', 'success');
        addResult('3. ××• ×¤×ª×— ××ª ×”××ª×¨ ×“×¨×š Netlify', 'success');
      } else {
        addResult('\nâœ… ×œ× ×‘-localhost', 'success');
        addResult('APP_CONFIG.enableFirebaseWrites ×××•×¨ ×œ×”×™×•×ª true', 'success');
      }
    }
  </script>
</body>
</html>
